[uwsgi]
# ============================================
# DripEmails.org uWSGI Configuration
# ============================================
# This configuration file is for running the Django application
# on a production server using uWSGI.

# ============================================
# Application Settings
# ============================================
# Django project module
module = dripemails.wsgi:application

# Python path - project root directory (where manage.py is located)
pythonpath = /home/dripemails/web/dripemails/lib/python3.12/site-packages

# Virtual environment path (points to the venv root, NOT site-packages)
# The venv root contains: bin/, lib/, include/, etc.
# COMMENTED OUT - The venv at /home/dripemails/web/dripemails appears corrupted
# If you have a working venv elsewhere, uncomment and update the path below
virtualenv = /home/dripemails/web/dripemails

# Alternative: Specify Python executable directly (if venv is corrupted)
# Uncomment one of these options:
# python = /usr/bin/python3.12
# python = /home/dripemails/venv/bin/python3
# python = /home/dripemails/.venv/bin/python3

# Django settings module for production
env = DJANGO_SETTINGS_MODULE=dripemails.live

# ============================================
# Process Management
# ============================================
# Master process - enables graceful reloads
master = true

# Number of worker processes (adjust based on CPU cores)
# Recommended: (2 * CPU cores) + 1
processes = 4

# Number of threads per worker
threads = 2

# Enable threads for better performance
enable-threads = true

# Vacuum - clean up on exit
vacuum = true

# Die on term - helps with graceful shutdowns
die-on-term = true

# ============================================
# Socket Configuration
# ============================================
# Socket to bind to (for Nginx reverse proxy)
# Use TCP socket for remote connections or Unix socket for local
socket = 127.0.0.1:8000
# Alternative: Unix socket (uncomment if using Unix socket)
# socket = /tmp/dripemails.sock
# chmod-socket = 666

# ============================================
# Logging
# ============================================
# Log file location
logto = /var/log/uwsgi/dripemails.log

# Log rotation
log-maxsize = 50000000
log-backupcount = 5

# Log requests
log-5xx = true

# Disable logging for successful requests (optional, reduces log size)
# disable-logging = true

# ============================================
# Performance & Resource Limits
# ============================================
# Maximum number of requests a worker can handle before being recycled
max-requests = 5000

# Maximum number of requests a worker can handle before being recycled (with exceptions)
max-requests-delta = 1000

# Memory limit per worker (in MB) - adjust based on your server
limit-as = 512

# Buffer size
buffer-size = 32768

# HTTP timeout
http-timeout = 60

# Socket timeout
socket-timeout = 60

# ============================================
# Static Files & Media
# ============================================
# Serve static files (if not using Nginx for static files)
# static-map = /static=/path/to/dripemails.org/staticfiles
# static-map = /media=/path/to/dripemails.org/media

# ============================================
# Security
# ============================================
# Drop privileges after binding to socket
# uid = www-data
# gid = www-data

# Chdir to project directory
chdir = /home/dripemails/web

# ============================================
# Advanced Options
# ============================================
# Lazy apps - load app in worker processes (better for memory)
lazy-apps = true

# Touch reload - reload when this file is touched
#touch-reload = /path/to/dripemails.org/reload

# Memory reporting
memory-report = true

# Stats server (for monitoring)
# stats = 127.0.0.1:9191
# stats-http = true

# ============================================
# Plugin (if needed)
# ============================================
# If you need specific plugins, uncomment and adjust
# plugins = python3

# ============================================
# Environment Variables
# ============================================
# Set any additional environment variables here
# env = CELERY_BROKER_URL=redis://localhost:6379/0
# env = REDIS_URL=redis://127.0.0.1:6379/1

# ============================================
# Harakiri (emergency worker restart)
# ============================================
# Kill workers that take too long to respond (in seconds)
harakiri = 60

# Harakiri verbose - log harakiri events
harakiri-verbose = true

# ============================================
# Optimization
# ============================================
# Preload application for faster worker startup
# preload = true

# Cheaper algorithm for dynamic worker scaling
# cheaper = 2
# cheaper-initial = 2
# cheaper-step = 1
# cheaper-algo = busyness
# cheaper-overload = 10
# cheaper-busyness-multiplier = 10

# ============================================
# Notes
# ============================================
# 1. Replace /path/to/dripemails.org with your actual project path
# 2. Adjust processes and threads based on your server resources
# 3. If using Nginx, configure it to proxy to the socket above
# 4. Make sure the log directory exists: mkdir -p /var/log/uwsgi
# 5. Ensure proper permissions for log files and socket
# 6. For systemd service, create a service file that runs:
#    uwsgi --ini /path/to/dripemails.org/docs/uwsgi.ini



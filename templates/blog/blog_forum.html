{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Community Forum" %} - DripEmails.org{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto py-12 px-4">
    <div class="mb-10">
        <h1 class="text-4xl font-bold text-indigo-700 mb-3">{% trans "Community Forum" %}</h1>
        <p class="text-lg text-gray-700">{% trans "Ask questions and get help from other users about using DripEmails.org." %}</p>
    </div>

    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">{% trans "Ask a Question" %}</h2>
        <form method="post" class="space-y-4">
            {% csrf_token %}
            {% if form.non_field_errors %}
            <div class="rounded-md bg-red-50 border border-red-200 p-3 text-sm text-red-700">
                {{ form.non_field_errors }}
            </div>
            {% endif %}
            <div>
                <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{% trans "Title" %}</label>
                {{ form.title }}
                {% if form.title.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.title.errors|striptags }}</p>
                {% endif %}
            </div>
            <div>
                <label for="{{ form.content.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">{% trans "Question Details" %}</label>
                {{ form.content }}
                {% if form.content.errors %}
                <p class="mt-1 text-sm text-red-600">{{ form.content.errors|striptags }}</p>
                {% endif %}
            </div>
            <div>
                <button type="submit" class="inline-flex items-center px-5 py-2.5 bg-indigo-600 text-white font-medium rounded-md hover:bg-indigo-700 transition-colors">
                    {% trans "Post Question" %}
                </button>
            </div>
        </form>
    </div>

    <div>
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">{% trans "Recent Questions" %}</h2>
        <div class="space-y-6">
            {% for question in forum_posts %}
            <article class="bg-white rounded-lg shadow p-6">
                <div class="flex items-start justify-between gap-4 mb-3">
                    <h3 class="text-xl font-semibold text-gray-900">
                        {{ question.title }}
                    </h3>
                    <span class="text-sm text-gray-500 whitespace-nowrap">{{ question.created_at }}</span>
                </div>
                <p class="text-gray-700 mb-4">{{ question.content }}</p>
                <div class="text-sm text-gray-500 mb-4">
                    {% blocktrans with author=question.user.username created_at=question.created_at updated_at=question.updated_at %}Asked by {{ author }} · Created: {{ created_at }} · Updated: {{ updated_at }}{% endblocktrans %}
                </div>
                <div class="border-t border-gray-200 pt-3">
                    <p class="text-sm text-gray-600">{% trans "Community answers can be posted as follow-up forum posts by other users." %}</p>
                </div>
            </article>
            {% empty %}
            <div class="bg-white rounded-lg shadow p-6 text-gray-600">
                {% trans "No questions yet. Be the first to ask one!" %}
            </div>
            {% endfor %}
        </div>

        {% if page_obj.paginator.num_pages > 1 %}
        <div class="mt-8 flex items-center justify-center gap-2">
            {% if page_obj.has_previous %}
            <a href="?{% if pagination_query %}{{ pagination_query }}&amp;{% endif %}page={{ page_obj.previous_page_number }}" class="px-3 py-2 rounded-md border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">{% trans "Previous" %}</a>
            {% endif %}

            <span class="px-3 py-2 text-sm text-gray-600">
                {% blocktrans with current=page_obj.number total=page_obj.paginator.num_pages %}Page {{ current }} of {{ total }}{% endblocktrans %}
            </span>

            {% if page_obj.has_next %}
            <a href="?{% if pagination_query %}{{ pagination_query }}&amp;{% endif %}page={{ page_obj.next_page_number }}" class="px-3 py-2 rounded-md border border-gray-300 text-sm text-gray-700 hover:bg-gray-50">{% trans "Next" %}</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
